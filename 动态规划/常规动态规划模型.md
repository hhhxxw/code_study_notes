
---

### **分步解析与总结**

#### **1. 研究背景与目标**
- **核心问题**：密集交通场景下，CAVs以紧密车距形成车队时，如何高效、安全地支持换道等机动操作。
- **解决方案**：基于CACC的恒定车距策略，结合前馈信号实现车距动态调整。
- **目标验证**：通过六车案例实验，证明方法的动态适应性和队列稳定性。

---

#### **2. 方法论详解**
##### **2.1 恒定车距策略（公式4）**
\[
x_i(t) = x_j(t) - d_i
\]
- **实现方式**：车辆通过LPF通信拓扑获取前车信息（距离、速度差、加速度），利用反馈控制计算加速度输入\(a_i^{\text{fb}}\)。
- **关键参数**：车距\(d_i=20\,\text{m}\)，通信结构依赖前车加速度和领头车全局信息。

##### **2.2 前馈信号扩展（公式5、6）**
\[
x_i(t) = x_j(t) - d_i + x_i^{\text{ff}}(t)
\]
\[
a_i(t) = a_i^{\text{fb}}(t) + a_i^{\text{ff}}(t)
\]
- **前馈设计**：通过梯形加速度曲线（正负对称）生成\(a_i^{\text{ff}}\)，积分得到\(x_i^{\text{ff}}\)，使车距动态调整20米。
- **控制逻辑**：反馈控制（PID）跟踪调整后的期望车距，前馈信号提供开环补偿。

---

#### **3. 实验设计与结果**
##### **3.1 六车案例设置**
- **领头车行为**：\(t=1\,\text{s}\)至\(t=3\,\text{s}\)加速，触发车队整体加速。
- **车距调整**：
  - 车辆3：\(t=4\,\text{s}\)至\(t=10\,\text{s}\)打开20米车距。
  - 车辆5：\(t=12\,\text{s}\)至\(t=18\,\text{s}\)重复相同操作。

##### **3.2 预期结果**
- **图2（前馈信号）**：
  - \(a_3^{\text{ff}}\)和\(a_5^{\text{ff}}\)呈梯形波形，前半段正加速，后半段负加速。
  - \(x_3^{\text{ff}}\)和\(x_5^{\text{ff}}\)在调整期内线性累积至20米，最终保持恒定。
- **图3（速度同步）**：
  - 所有车辆在\(t=1\,\text{s}-3\,\text{s}\)同步加速，速度曲线重叠。
  - 车辆3和5在调整期速度短暂波动，其他车辆保持稳定。

---

#### **4. 代码复现关键点**
##### **4.1 SUMO路网修正**
- **问题**：车道形状未定义导致路网构建失败。
- **解决方案**：
  - 显式定义车道形状：`<lane ... shape="0,50 1000,50"/>`。
  - 使用`netconvert`工具自动生成路网（推荐）。

##### **4.2 前馈信号逻辑修正**
- **问题**：车距调整未达20米或波形异常。
- **修正步骤**：
  1. **梯形加速度计算**：
     \[
     a_{\text{ff}} = \begin{cases} 
     \frac{40}{T^2} & t \leq T/2, \\
     -\frac{40}{T^2} & t > T/2.
     \end{cases}
     \]
     其中\(T=6\,\text{s}\)（车辆3）或\(T=6\,\text{s}\)（车辆5）。
  2. **积分验证**：确保时间步长\(dt=0.1\,\text{s}\)下的速度和位移积分准确。

##### **4.3 车辆ID与数据记录**
- **问题**：车辆ID不匹配或数据记录混杂字符串。
- **修正步骤**：
  1. 绑定前馈信号至正确ID（如车辆3对应`veh3`）。
  2. 数据记录时仅保存数值，避免混杂标签。

##### **4.4 反馈控制公式修正**
- **问题**：期望车距计算错误导致跟踪偏差。
- **修正公式**：
  \[
  \text{desired\_gap} = 20 + x_i^{\text{ff}}
  \]
  而非`20 - x_i^{\text{ff}}`。

---

#### **5. 验证与调试**
##### **5.1 SUMO可视化验证**
```bash
sumo-gui -c test.sumocfg
```
- **观察点**：
  - 领头车加速时车队是否同步。
  - 车辆3和5是否在指定时间窗口内打开车距。

##### **5.2 调试输出**
```python
# 添加前馈信号调试输出
if veh_id in ff_states and ff_states[veh_id]['active']:
    print(f"t={current_time:.1f}s | {veh_id} | a_ff={state['a_ff']:.3f} | x_ff={state['x_ff']:.3f}")
```
- **预期输出**：
  ```
  t=4.0s | veh3 | a_ff=1.111 | x_ff=0.111
  t=7.0s | veh3 | a_ff=-1.111 | x_ff=10.000
  t=10.0s | veh3 | a_ff=0.000 | x_ff=20.000
  ```

##### **5.3 图表生成检查**
- **图2**：确认\(x_3^{\text{ff}}\)和\(x_5^{\text{ff}}\)最终值为20米，波形对称。
- **图3**：速度曲线在车距调整期轻微波动，整体保持同步。

---

### **总结**
本文方法通过扩展CACC的前馈控制，实现了密集车队中车距的动态调整与换道支持。复现时需严格遵循公式定义，确保路网构建、信号生成、控制逻辑和数据记录的准确性。通过SUMO可视化与调试输出逐步验证各环节，最终可生成与论文一致的实验结果。